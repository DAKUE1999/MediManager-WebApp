@model MediManager_WebApp.Models.ViewModels.StockViewModel

@{
    ViewData["Title"] = "Medikament einlagern";
}

<div class="container-fluid">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Warehouse" asp-action="Index">Lager</a></li>
            <li class="breadcrumb-item active" aria-current="page">Einlagern</li>
        </ol>
    </nav>

    <h1>@ViewData["Title"]</h1>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="row">
        <div class="col-md-6">
            <!-- PZN-Prüfungs-Formular -->
            <form asp-action="CheckPZN" method="post" id="pznForm">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="form-group">
                            <label asp-for="PZN" class="control-label">PZN</label>
                            <div class="input-group">
                                <input asp-for="PZN" class="form-control" value="@TempData["PZN"]" />
                                <button type="submit" class="btn btn-secondary">Prüfen</button>
                            </div>
                            <span asp-validation-for="PZN" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </form>

            <!-- Einlagerungs-Formular -->
            @if (ViewBag.MedicationFound == true)
            {
                <form asp-action="Create" method="post" id="stockForm">
                    <input type="hidden" asp-for="PZN" value="@TempData["PZN"]" />
                    <input type="hidden" asp-for="MedicationID" value="@TempData["MedicationID"]" />
                    <input type="hidden" asp-for="MedicationGroupID" value="@TempData["MedicationGroupID"]" />

                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">@TempData["MedicationName"]</h5>
                        </div>
                        <div class="card-body">
                            <!-- Lager auswählen -->
                            <div class="form-group mb-3">
                                <label class="control-label">Lager</label>
                                <div class="input-group">
                                    <input type="text" id="selectedWarehouseDisplay" class="form-control" readonly 
                                           placeholder="Bitte wählen Sie ein Lager aus" 
                                           value="@TempData["WarehouseName"]" />
                                    <button type="button" class="btn btn-outline-secondary" onclick="showWarehouseSelector()">
                                        Auswählen
                                    </button>
                                </div>
                                <input type="hidden" asp-for="WarehouseID" id="selectedWarehouseId" value="@TempData["WarehouseID"]" />
                                <span asp-validation-for="WarehouseID" class="text-danger"></span>
                            </div>

                            <!-- Rest der Formularfelder -->
                            <div class="form-group mb-3">
                                <label asp-for="Batch" class="control-label">Charge</label>
                                <input asp-for="Batch" class="form-control" value="@TempData["Batch"]" />
                                <span asp-validation-for="Batch" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-3">
                                <label asp-for="SerialNumber" class="control-label">Seriennummer</label>
                                <input asp-for="SerialNumber" class="form-control" value="@TempData["SerialNumber"]" />
                                <span asp-validation-for="SerialNumber" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-3">
                                <label asp-for="ExpireDate" class="control-label">Verfallsdatum</label>
                                <input asp-for="ExpireDate" class="form-control" type="date" value="@TempData["ExpireDate"]" />
                                <span asp-validation-for="ExpireDate" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-3">
                                <label asp-for="Quantity" class="control-label">Menge</label>
                                <input asp-for="Quantity" class="form-control" type="number" min="1" value="@TempData["Quantity"]" />
                                <span asp-validation-for="Quantity" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Einlagern</button>
                                <a asp-action="Index" class="btn btn-secondary">Zurück zur Liste</a>
                            </div>
                        </div>
                    </div>
                </form>
            }
        </div>
    </div>
</div>